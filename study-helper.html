<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Study Helper — emike's projects</title>
  <meta name="description" content="Configure and run custom multiple choice study sessions with your own datasets." />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%23000'/%3E%3Cpath d='M22 70h56v8H22zM27 60h46v6H27zM34 26c0-4 3-7 7-7s7 3 7 7-3 7-7 7-7-3-7-7zm-2 18h29a3 3 0 0 1 0 6H51l3 6h10a3 3 0 1 1 0 6H36l-6-12h-6a3 3 0 1 1 0-6h8z' fill='%23facc15'/%3E%3C/svg%3E" />
  <style>
    :root {
      color-scheme: light dark;
      --bg: hsl(232 24% 10%);
      --bg-2: hsl(230 28% 8%);
      --bg-card: hsl(233 36% 18% / 0.78);
      --fg: hsl(0 0% 100%);
      --fg-soft: hsl(222 20% 82%);
      --border: hsl(0 0% 100% / 0.16);
      --accent: hsl(46 98% 61%);
      --accent-strong: hsl(32 100% 52%);
      --shadow: 0 16px 45px hsl(230 46% 8% / 0.45);
      --radius-large: 28px;
      --radius: 16px;
      --transition: 180ms ease;
      --code-bg: hsl(232 36% 22%);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100dvh;
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", sans-serif;
      letter-spacing: -0.01em;
      background:
        radial-gradient(1200px 800px at 12% 10%, hsl(250 70% 22% / 0.35), transparent 60%),
        radial-gradient(900px 700px at 88% 8%, hsl(200 78% 16% / 0.32), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg-2));
      color: var(--fg);
      overflow-x: hidden;
    }

    .glow-grid::before {
      content: "";
      position: fixed;
      inset: -10vmax;
      background:
        repeating-linear-gradient(0deg, hsl(0 0% 100% / 0.035) 0 1px, transparent 1px 90px),
        repeating-linear-gradient(90deg, hsl(0 0% 100% / 0.025) 0 1px, transparent 1px 110px);
      opacity: 0.6;
      pointer-events: none;
      animation: drift 32s linear infinite;
      transform: translateZ(0);
      filter: blur(0.4px);
    }

    @keyframes drift {
      to { transform: translate3d(80px, 60px, 0); }
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    header {
      width: min(1100px, 94vw);
      margin: 0 auto;
      padding: 36px 0 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 18px;
    }

    .logo {
      font-size: clamp(1.25rem, 1.8vw, 1.6rem);
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      gap: 12px;
      letter-spacing: -0.03em;
    }

    .logo span {
      padding: 10px 14px;
      border-radius: 16px;
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      color: hsl(230 20% 12%);
      box-shadow: 0 12px 30px hsl(40 100% 57% / 0.32);
    }

    .home-actions {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.55rem;
      padding: 10px 16px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: hsl(0 0% 100% / 0.05);
      color: var(--fg);
      font-weight: 600;
      transition: transform var(--transition), box-shadow var(--transition), border-color var(--transition), background var(--transition);
    }

    .btn:hover {
      transform: translateY(-1px);
      border-color: hsl(0 0% 100% / 0.3);
      box-shadow: 0 12px 28px hsl(230 42% 10% / 0.3);
      background: hsl(0 0% 100% / 0.08);
    }

    .btn.primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      color: hsl(230 22% 12%);
      border-color: transparent;
      box-shadow: 0 16px 38px hsl(35 100% 56% / 0.45);
    }

    .btn.primary:hover { transform: translateY(-2px); }

    main {
      width: min(1100px, 94vw);
      margin: 0 auto 120px;
      display: grid;
      gap: 54px;
    }

    .hero {
      position: relative;
      padding: clamp(32px, 5vw, 64px);
      border-radius: var(--radius-large);
      background: linear-gradient(180deg, hsl(234 54% 22% / 0.82), hsl(232 44% 16% / 0.92));
      border: 1px solid hsl(0 0% 100% / 0.18);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .hero::after {
      content: "";
      position: absolute;
      inset: 15% -30% -35%;
      background: radial-gradient(500px 180px at 60% 30%, hsl(45 98% 61% / 0.45), transparent 70%);
      filter: blur(12px);
      opacity: 0.9;
      pointer-events: none;
    }

    .hero h1 {
      font-size: clamp(2.4rem, 5.2vw, 3.6rem);
      margin: 0 0 18px;
      line-height: 1.05;
      letter-spacing: -0.04em;
    }

    .hero p {
      margin: 0 0 26px;
      font-size: clamp(1.05rem, 1.6vw, 1.2rem);
      color: var(--fg-soft);
      max-width: 560px;
    }

    section#study-helper {
      padding: clamp(32px, 4vw, 48px);
      border-radius: var(--radius-large);
      background: linear-gradient(145deg, hsl(232 50% 18% / 0.95), hsl(233 45% 16% / 0.92));
      border: 1px solid hsl(0 0% 100% / 0.16);
      box-shadow: var(--shadow);
    }

    section#study-helper header {
      width: 100%;
      padding: 0;
      margin: 0 0 28px;
      justify-content: flex-start;
    }

    section#study-helper header h2 {
      font-size: clamp(1.8rem, 3vw, 2.4rem);
      margin: 0;
      letter-spacing: -0.03em;
    }

    section#study-helper header p {
      margin: 8px 0 0;
      color: var(--fg-soft);
      max-width: 620px;
      font-size: 1rem;
    }

    .study-layout {
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1.1fr);
      gap: 32px;
    }

    .panel {
      background: hsl(233 46% 14% / 0.8);
      border-radius: var(--radius);
      padding: 22px;
      border: 1px solid hsl(0 0% 100% / 0.1);
      display: grid;
      gap: 18px;
    }

    .panel h3 {
      margin: 0;
      font-size: 1.1rem;
      letter-spacing: -0.015em;
    }

    label {
      display: grid;
      gap: 6px;
      font-weight: 600;
      font-size: 0.95rem;
      color: hsl(40 100% 80%);
    }

    textarea, select, input[type="text"] {
      padding: 12px;
      border-radius: 12px;
      border: 1px solid hsl(0 0% 100% / 0.12);
      background: hsl(235 40% 20% / 0.72);
      color: var(--fg);
      font-family: "Inter", system-ui, sans-serif;
      font-size: 0.95rem;
      resize: vertical;
      transition: border-color var(--transition), box-shadow var(--transition);
    }

    textarea:focus,
    input:focus,
    select:focus {
      outline: none;
      border-color: hsl(40 100% 65%);
      box-shadow: 0 0 0 2px hsl(40 100% 65% / 0.25);
    }

    textarea {
      min-height: 180px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
      background: var(--code-bg);
    }

    .controls {
      display: grid;
      gap: 12px;
      font-size: 0.95rem;
    }

    .controls fieldset {
      margin: 0;
      border: 1px solid hsl(0 0% 100% / 0.12);
      border-radius: 14px;
      padding: 14px 16px;
      background: hsl(233 40% 20% / 0.4);
    }

    .controls legend {
      padding: 0 6px;
      font-weight: 600;
      color: var(--fg);
    }

    .radio-group {
      display: grid;
      gap: 8px;
    }

    .radio-option {
      display: inline-flex;
      gap: 10px;
      align-items: center;
      font-weight: 500;
    }

    .study-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .study-actions button {
      border: none;
    }

    .study-actions .ghost {
      border: 1px solid hsl(0 0% 100% / 0.18);
      background: transparent;
      color: var(--fg);
    }

    .study-actions .ghost:hover {
      background: hsl(0 0% 100% / 0.08);
    }

    .sample {
      padding: 12px 16px;
      border-radius: 14px;
      background: hsl(233 32% 22% / 0.65);
      border: 1px dashed hsl(40 100% 65% / 0.6);
      font-size: 0.9rem;
      color: var(--fg-soft);
      display: grid;
      gap: 10px;
    }

    .sample code {
      background: hsl(232 36% 20%);
      padding: 10px 12px;
      border-radius: 12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
      display: block;
      white-space: pre-wrap;
    }

    .session {
      display: grid;
      gap: 20px;
    }

    .question-card {
      background: hsl(233 50% 14% / 0.9);
      border-radius: 18px;
      padding: 22px;
      border: 1px solid hsl(0 0% 100% / 0.12);
      display: grid;
      gap: 14px;
    }

    .question-card h4 {
      margin: 0;
      font-size: 1.05rem;
      letter-spacing: -0.02em;
    }

    .question-card small {
      color: hsl(40 100% 78%);
      font-weight: 600;
    }

    .choices {
      display: grid;
      gap: 8px;
    }

    .choices label {
      border: 1px solid hsl(0 0% 100% / 0.1);
      border-radius: 14px;
      padding: 12px 14px;
      gap: 10px;
      font-weight: 500;
      background: hsl(232 38% 20% / 0.5);
      color: var(--fg);
      cursor: pointer;
      transition: border-color var(--transition), background var(--transition), transform var(--transition);
    }

    .choices input[type="radio"] {
      margin: 0;
      accent-color: var(--accent);
    }

    .choices label.correct {
      border-color: hsl(145 78% 60%);
      background: hsl(147 52% 22% / 0.65);
    }

    .choices label.incorrect {
      border-color: hsl(0 72% 62%);
      background: hsl(353 52% 24% / 0.5);
    }

    .feedback {
      font-size: 0.92rem;
      border-radius: 12px;
      padding: 12px 14px;
      background: hsl(233 40% 20% / 0.65);
      border: 1px solid hsl(0 0% 100% / 0.12);
      color: var(--fg-soft);
    }

    .feedback strong {
      display: inline-block;
      font-size: 0.95rem;
      margin-right: 6px;
      color: var(--accent);
    }

    .session-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    .session-summary {
      border-radius: 16px;
      background: hsl(233 36% 20% / 0.6);
      border: 1px solid hsl(0 0% 100% / 0.16);
      padding: 16px 18px;
      font-size: 0.95rem;
      color: var(--fg-soft);
    }

    footer {
      width: min(1100px, 94vw);
      margin: 0 auto 48px;
      padding: 18px 0 0;
      border-top: 1px solid hsl(0 0% 100% / 0.1);
      color: hsl(0 0% 90% / 0.65);
      font-size: 0.9rem;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 10px;
    }

    footer a {
      color: var(--accent);
      font-weight: 600;
    }

    footer .stripes {
      position: relative;
      width: 100%;
      height: 12px;
      background: repeating-linear-gradient(135deg, var(--accent) 0 16px, hsl(230 22% 16%) 16px 32px);
      mask-image: linear-gradient(to top, black, transparent);
      animation: slide 2.2s linear infinite;
      margin-top: 14px;
    }

    @keyframes slide {
      to { background-position: 64px 0; }
    }

    @media (max-width: 900px) {
      .study-layout {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 680px) {
      header {
        flex-direction: column;
        align-items: flex-start;
      }

      .home-actions {
        width: 100%;
        justify-content: flex-start;
        flex-wrap: wrap;
      }

      .hero { padding: 28px; }
      .study-actions { flex-direction: column; align-items: stretch; }
      .study-actions .btn { width: 100%; justify-content: center; }
    }

    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
  </style>
</head>
<body class="glow-grid">
  <a class="visually-hidden" href="#study-helper">Skip to study helper</a>
  <header>
    <a class="logo" href="index.html">
      <span>emike</span>
      <div>projects lab</div>
    </a>
    <nav class="home-actions" aria-label="Secondary actions">
      <a class="btn" href="index.html">← Back to app hub</a>
      <a class="btn primary" href="mailto:emikeholland@icloud.com">Email</a>
    </nav>
  </header>

  <main>
    <section class="hero" aria-labelledby="hero-title">
      <h1 id="hero-title">Study Helper</h1>
      <p>Paste a dataset of multiple choice questions, choose how you want them delivered, and practice with instant or end-of-quiz feedback. Perfect for vocab drills, quick fact checks, or exam prep.</p>
      <div class="home-actions">
        <a class="btn primary" href="#study-helper">Configure a session</a>
        <a class="btn" href="#prompt-tip">Get the ChatGPT prompt</a>
      </div>
    </section>

    <section id="study-helper" aria-labelledby="study-helper-title">
      <header>
        <div>
          <h2 id="study-helper-title">Build your quiz</h2>
          <p>Paste or load your dataset, tweak the flow, and start quizzing. The only rule: each question needs a unique correct answer that matches one of its choices.</p>
        </div>
      </header>

      <div class="study-layout">
        <div class="panel" aria-labelledby="dataset-title">
          <h3 id="dataset-title">1. Prep your dataset</h3>

          <label for="dataset-input">
            Paste questions (JSON format)
            <textarea id="dataset-input" spellcheck="false" placeholder='[{"question": "...", "choices": ["A", "B"], "answer": "A"}]'></textarea>
          </label>

          <div class="study-actions">
            <button type="button" class="btn ghost" id="load-example">Load example</button>
            <button type="button" class="btn ghost" id="copy-template">Copy ChatGPT prompt</button>
          </div>

          <div class="sample" id="prompt-tip" aria-live="polite">
            <strong>Tip:</strong>
            Use this prompt with ChatGPT to convert vocab or key facts into the format above.
            <code id="prompt-text">Turn the following vocabulary list into JSON where each object has "question", "choices", "answer", and an "explanation". Each question should only have one correct answer. Answers must exactly match one of the choices. Output valid JSON only.</code>
          </div>
        </div>

        <div class="panel" aria-labelledby="session-options">
          <h3 id="session-options">2. Configure your session</h3>

          <div class="controls">
            <fieldset>
              <legend>Question flow</legend>
              <div class="radio-group">
                <label class="radio-option">
                  <input type="radio" name="flow" value="single" checked />
                  One question at a time
                </label>
                <label class="radio-option">
                  <input type="radio" name="flow" value="all" />
                  Whole quiz at once
                </label>
              </div>
            </fieldset>

            <fieldset>
              <legend>Feedback style</legend>
              <div class="radio-group">
                <label class="radio-option">
                  <input type="radio" name="feedback" value="instant" checked />
                  Instant feedback after each answer
                </label>
                <label class="radio-option">
                  <input type="radio" name="feedback" value="summary" />
                  Summary feedback at the end
                </label>
              </div>
            </fieldset>
          </div>

          <div class="study-actions">
            <button type="button" class="btn primary" id="start-session">Start practice</button>
            <button type="button" class="btn ghost" id="reset-session">Reset session</button>
          </div>

          <div class="session-summary" id="session-summary" hidden></div>
        </div>
      </div>

      <div class="session" id="session-area" aria-live="polite"></div>
    </section>
  </main>

  <footer>
    <div>© <span id="year"></span> emike — always learning.</div>
    <div>Questions or ideas? <a href="mailto:emikeholland@icloud.com">Say hello.</a></div>
    <div class="stripes" aria-hidden="true"></div>
  </footer>

  <template id="question-template">
    <article class="question-card">
      <small></small>
      <h4></h4>
      <div class="choices"></div>
      <div class="feedback" hidden></div>
    </article>
  </template>

  <script>
    const datasetInput = document.getElementById('dataset-input');
    const loadExampleBtn = document.getElementById('load-example');
    const copyTemplateBtn = document.getElementById('copy-template');
    const startSessionBtn = document.getElementById('start-session');
    const resetSessionBtn = document.getElementById('reset-session');
    const sessionArea = document.getElementById('session-area');
    const sessionSummary = document.getElementById('session-summary');
    const questionTemplate = document.getElementById('question-template');
    const promptText = document.getElementById('prompt-text').textContent.trim();
    const yearEl = document.getElementById('year');

    yearEl.textContent = new Date().getFullYear();

    const defaultDataset = [
      {
        "question": "Which biomolecule is the primary source of quick energy for cells?",
        "choices": ["Proteins", "Carbohydrates", "Lipids", "Nucleic acids"],
        "answer": "Carbohydrates",
        "explanation": "Carbohydrates break down quickly into glucose, which cells use for immediate energy."
      },
      {
        "question": "In Shakespeare's 'Romeo and Juliet', which family does Romeo belong to?",
        "choices": ["Capulet", "Montague", "Escalus", "Mercutio"],
        "answer": "Montague",
        "explanation": "Romeo is a Montague. Juliet is from the Capulet family, and their families are feuding."
      },
      {
        "question": "What does HTTP stand for?",
        "choices": ["HyperText Transfer Protocol", "High Traffic Transfer Process", "HyperText Tracking Platform", "Hyperlink Transfer Program"],
        "answer": "HyperText Transfer Protocol",
        "explanation": "HTTP (HyperText Transfer Protocol) is the foundation of data communication for the World Wide Web."
      },
      {
        "question": "Which planet in our solar system has the most moons?",
        "choices": ["Earth", "Mars", "Saturn", "Venus"],
        "answer": "Saturn",
        "explanation": "Saturn currently holds the record with more than 80 confirmed moons."
      }
    ];

    const exampleDataset = JSON.stringify(defaultDataset, null, 2);

    loadExampleBtn.addEventListener('click', () => {
      datasetInput.value = exampleDataset;
      datasetInput.focus();
    });

    copyTemplateBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(promptText);
        copyTemplateBtn.textContent = 'Prompt copied!';
        setTimeout(() => (copyTemplateBtn.textContent = 'Copy ChatGPT prompt'), 2400);
      } catch (error) {
        copyTemplateBtn.textContent = 'Copy not supported';
        setTimeout(() => (copyTemplateBtn.textContent = 'Copy ChatGPT prompt'), 2400);
      }
    });

    resetSessionBtn.addEventListener('click', () => {
      sessionArea.innerHTML = '';
      sessionSummary.hidden = true;
      sessionSummary.textContent = '';
    });

    startSessionBtn.addEventListener('click', () => {
      let dataset;
      try {
        dataset = JSON.parse(datasetInput.value);
        if (!Array.isArray(dataset)) throw new Error('Dataset must be an array of questions.');
      } catch (error) {
        alert('Please provide valid JSON. ' + error.message);
        return;
      }

      const normalizedQuestions = dataset
        .map((item, idx) => normalizeQuestion(item, idx))
        .filter(Boolean);

      if (!normalizedQuestions.length) {
        alert('No valid questions found. Each question needs "question", "choices" (array), and "answer".');
        return;
      }

      const flow = document.querySelector('input[name="flow"]:checked')?.value ?? 'single';
      const feedback = document.querySelector('input[name="feedback"]:checked')?.value ?? 'instant';

      buildSession(normalizedQuestions, { flow, feedback });
    });

    function normalizeQuestion(item, index) {
      if (!item || typeof item !== 'object') return null;
      const question = String(item.question ?? '').trim();
      const choices = Array.isArray(item.choices) ? item.choices.map(choice => String(choice)) : [];
      const answer = String(item.answer ?? '').trim();
      const explanation = String(item.explanation ?? '').trim();

      if (!question || !choices.length || !answer) {
        console.warn('Invalid question at index', index);
        return null;
      }

      if (!choices.includes(answer)) {
        console.warn('Answer does not match any choice at index', index);
        return null;
      }

      return { question, choices, answer, explanation };
    }

    function buildSession(questions, options) {
      sessionArea.innerHTML = '';
      sessionSummary.hidden = true;
      sessionSummary.textContent = '';

      if (options.flow === 'single') {
        renderSingleQuestionMode(questions, options.feedback);
      } else {
        renderAllQuestionMode(questions, options.feedback);
      }
    }

    function renderSingleQuestionMode(questions, feedbackMode) {
      let currentIndex = 0;
      const answers = new Map();
      const total = questions.length;

      const questionContainer = document.createElement('div');
      sessionArea.appendChild(questionContainer);

      const controls = document.createElement('div');
      controls.className = 'session-controls';
      const prevBtn = createButton('Previous', 'ghost');
      const nextBtn = createButton('Next', 'ghost');
      const submitBtn = createButton('Finish & see score', 'primary');

      prevBtn.disabled = true;
      submitBtn.disabled = feedbackMode === 'instant';

      controls.append(prevBtn, nextBtn, submitBtn);
      sessionArea.appendChild(controls);

      renderQuestion();

      prevBtn.addEventListener('click', () => {
        if (currentIndex > 0) {
          currentIndex -= 1;
          renderQuestion();
        }
      });

      nextBtn.addEventListener('click', () => {
        if (currentIndex < total - 1) {
          currentIndex += 1;
          renderQuestion();
        }
      });

      submitBtn.addEventListener('click', () => {
        const results = evaluateAnswers(questions, answers);
        showSummary(results, feedbackMode === 'instant');
      });

      function renderQuestion() {
        questionContainer.innerHTML = '';
        const question = questions[currentIndex];
        const node = createQuestionNode(question, currentIndex, total, feedbackMode, answers.get(currentIndex));
        questionContainer.appendChild(node);

        attachChoiceListeners(node, question, currentIndex);

        prevBtn.disabled = currentIndex === 0;
        nextBtn.disabled = currentIndex === total - 1;

        if (feedbackMode === 'instant' && answers.has(currentIndex)) {
          revealFeedbackInstant(node, question, answers.get(currentIndex));
        }
      }

      function attachChoiceListeners(node, question, index) {
        const radios = node.querySelectorAll('input[type="radio"]');
        radios.forEach(radio => {
          radio.addEventListener('change', () => {
            answers.set(index, radio.value);
            if (feedbackMode === 'instant') {
              revealFeedbackInstant(node, question, radio.value);
            }
          });
        });
      }
    }

    function renderAllQuestionMode(questions, feedbackMode) {
      const answers = new Map();
      const total = questions.length;

      questions.forEach((question, index) => {
        const node = createQuestionNode(question, index, total, feedbackMode, null);
        sessionArea.appendChild(node);

        const radios = node.querySelectorAll('input[type="radio"]');
        radios.forEach(radio => {
          radio.addEventListener('change', () => {
            answers.set(index, radio.value);
            if (feedbackMode === 'instant') {
              revealFeedbackInstant(node, question, radio.value);
            }
          });
        });
      });

      if (feedbackMode === 'summary') {
        const controls = document.createElement('div');
        controls.className = 'session-controls';
        const submitBtn = createButton('Check answers', 'primary');
        controls.appendChild(submitBtn);
        sessionArea.appendChild(controls);

        submitBtn.addEventListener('click', () => {
          const results = evaluateAnswers(questions, answers);
          showSummary(results, false);
          revealFeedbackForAll(questions, answers);
        });
      }
    }

    function createQuestionNode(question, index, total, feedbackMode, selectedValue) {
      const fragment = questionTemplate.content.cloneNode(true);
      const article = fragment.querySelector('.question-card');
      const meta = article.querySelector('small');
      const title = article.querySelector('h4');
      const choicesWrapper = article.querySelector('.choices');
      const feedbackEl = article.querySelector('.feedback');

      meta.textContent = `Question ${index + 1} of ${total}`;
      title.textContent = question.question;

      question.choices.forEach(choice => {
        const id = `q${index}-${choice.replace(/\W+/g, '').toLowerCase()}`;
        const label = document.createElement('label');
        label.setAttribute('for', id);

        const radio = document.createElement('input');
        radio.type = 'radio';
        radio.name = `question-${index}`;
        radio.id = id;
        radio.value = choice;
        if (selectedValue && selectedValue === choice) {
          radio.checked = true;
        }

        const span = document.createElement('span');
        span.textContent = choice;

        label.append(radio, span);
        choicesWrapper.appendChild(label);
      });

      if (feedbackMode === 'instant') {
        feedbackEl.hidden = true;
      }

      return article;
    }

    function revealFeedbackInstant(node, question, selectedValue) {
      const labels = node.querySelectorAll('.choices label');
      labels.forEach(label => {
        label.classList.remove('correct', 'incorrect');
      });

      labels.forEach(label => {
        const radio = label.querySelector('input[type="radio"]');
        if (!radio) return;
        if (radio.value === question.answer) {
          label.classList.add('correct');
        } else if (radio.value === selectedValue) {
          label.classList.add('incorrect');
        }
      });

      const feedbackEl = node.querySelector('.feedback');
      const isCorrect = selectedValue === question.answer;
      feedbackEl.innerHTML = `<strong>${isCorrect ? 'Correct!' : 'Not quite.'}</strong>${question.explanation || ''}`;
      feedbackEl.hidden = false;
    }

    function revealFeedbackForAll(questions, answers) {
      const nodes = sessionArea.querySelectorAll('.question-card');
      nodes.forEach((node, index) => {
        const question = questions[index];
        const selectedValue = answers.get(index);
        if (!selectedValue) return;
        revealFeedbackInstant(node, question, selectedValue);
      });
    }

    function evaluateAnswers(questions, answers) {
      let correct = 0;
      const total = questions.length;
      const details = questions.map((question, index) => {
        const picked = answers.get(index);
        const isCorrect = picked === question.answer;
        if (isCorrect) correct += 1;
        return { question: question.question, picked, answer: question.answer, isCorrect };
      });
      return { correct, total, details };
    }

    function showSummary(results, alreadyGiven) {
      const { correct, total, details } = results;
      const unanswered = details.filter(item => !item.picked).length;
      const scorePercent = Math.round((correct / total) * 100);

      const lines = [
        `Score: ${correct}/${total} (${scorePercent}%)`,
        unanswered ? `${unanswered} question${unanswered !== 1 ? 's' : ''} unanswered.` : 'All questions answered.',
        alreadyGiven ? 'Instant feedback already shown above.' : 'Scroll up to review explanations now revealed above.'
      ];

      sessionSummary.innerHTML = lines.join('<br>');
      sessionSummary.hidden = false;
      sessionSummary.focus?.();
    }

    function createButton(label, variant) {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = `btn ${variant ?? 'ghost'}`;
      btn.textContent = label;
      return btn;
    }
  </script>
</body>
</html>
